#!/usr/bin/env ruby
#
$:.unshift(File.dirname(__FILE__))
require 'rubygems'
require 'snorby_suite'

factory = SnorbySuite::Pcapfactory.new

def pcapfile
  "/tmp/pcapfactory.#{(rand(899999)+100000)}-#{$$}.pcap"
end

loop do

  factory.filename = pcapfile
  puts "Regenerating pcap file '#{factory.filename}' .."
  
  factory.generate
  factory.write_pcaps
  
  puts "Running Snort.."
  `snort -r #{factory.filename} -c #{SnorbySuite::SNORTCONF} -l #{SnorbySuite::UNIFIEDDIR} -q`
  puts "Closing Snort."
  
  sleep(15)
  factory.flush
end


